Ce programme Python est une application web interactive basÃ©e sur Flask, conÃ§ue pour faire jouer plusieurs personnes Ã  un **jeu de cartes narratif collaboratif** dans un **univers mÃ©diÃ©val-fantastique**. Voici une explication claire de ses principales fonctionnalitÃ©s :

---

### ğŸ§© **But du jeu**

CrÃ©er une **histoire collective** cohÃ©rente Ã  partir dâ€™un scÃ©nario de dÃ©part en **jouant des cartes Ã  tour de rÃ´le**, chaque carte influenÃ§ant lâ€™histoire de maniÃ¨re **positive** ou **nÃ©gative** selon le rÃ´le du joueur.

---

### ğŸ® **Fonctionnement gÃ©nÃ©ral**

1. **Interface Web (HTML/CSS/JS)** :

   * Permet aux joueurs de :

     * Saisir leur pseudo et rÃ´le (Soldat, Moine, SorciÃ¨re, Forgeron).
     * Envoyer un "prompt" (soit un message, soit un numÃ©ro de carte).
     * Voir le dÃ©roulÃ© de lâ€™histoire, le score, les cartes jouÃ©es, etc.
     * Sauvegarder ou rÃ©initialiser la partie.

2. **Serveur Flask (Backend)** :

   * Fournit la page web (route `/`).
   * GÃ¨re les requÃªtes comme :

     * `/envoyer` : traitement de la carte jouÃ©e â†’ envoie lâ€™effet narratif via lâ€™API **Mistral AI**.
     * `/refresh` : rafraÃ®chit lâ€™Ã©tat du jeu et dÃ©tecte les joueurs actifs.
     * `/reset` et `/sauver` : pour relancer ou sauvegarder la partie.
     * `/download/<filename>` : tÃ©lÃ©chargement d'une sauvegarde du rÃ©cit.

3. **Cartes** :

   * ChargÃ©es depuis `deck.json`.
   * Chaque carte a :

     * un numÃ©ro,
     * un mot-clÃ©,
     * une phrase descriptive.
   * Les **effets des cartes** (positif, nÃ©gatif, neutre) selon le rÃ´le sont dans `evaluations.json`.

4. **Narration via Mistral AI** :

   * Ã€ chaque carte jouÃ©e, lâ€™API gÃ©nÃ¨re un court texte (20-25 mots) qui fait avancer lâ€™histoire selon :

     * le **contexte narratif**,
     * le **rÃ´le du joueur**,
     * lâ€™**effet de la carte**.
   * Ã€ la fin du jeu, une **conclusion** est gÃ©nÃ©rÃ©e en fonction du score (positive ou nÃ©gative).

5. **Scoring et logique de jeu** :

   * Le score commence Ã  `2 Ã— nb de joueurs`.
   * Il augmente ou diminue selon lâ€™effet de la carte.
   * Le jeu se termine si :

     * Le score tombe Ã  0.
     * Il nâ€™y a plus de cartes Ã  jouer.
     * Le joueur demande une conclusion (`prompt == 0`).

---

### ğŸ•¹ï¸ Autres fonctionnalitÃ©s

* **DÃ©tection de joueurs actifs** via `ping` toutes les secondes.
* **RÃ©initialisation automatique** aprÃ¨s 10 minutes dâ€™inactivitÃ©.
* **Journalisation des parties** dans un fichier `log.txt`.

---

### ğŸ” ClÃ© API

Le jeu utilise `Mistral` pour la gÃ©nÃ©ration de texte. La clÃ© API est rÃ©cupÃ©rÃ©e depuis `.env`, ce qui permet de la maintenir confidentielle.

---

### Exemple de flux

1. Un joueur entre son pseudo et rÃ´le.
2. Il choisit une carte Ã  jouer (ex : carte 5 : "Corbeau").
3. L'effet de la carte (selon le rÃ´le) est utilisÃ© par Mistral pour gÃ©nÃ©rer une phrase de lâ€™histoire.
4. Le score est mis Ã  jour.
5. Le rÃ©cit progresse jusquâ€™Ã  la fin.

---

